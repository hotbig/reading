CH03 IP: 网际协议
-----------------------------------------------------------------------------------------------
网络字节序，子网，子网掩码，A类地址，B类地址，C类地址，D类地址。

CH04 ARP: 地址解析协议
-----------------------------------------------------------------------------------------------
.1 IP地址到物理地址的映射，arp命令可以检查ARM高速缓存的内容

CH06 ICMP: Internet控制报文协议
-----------------------------------------------------------------------------------------------
.1 ICMP是在IP报文内部传输的

CH07 PING程序
-----------------------------------------------------------------------------------------------
一个例子：
step1: arp -d 192.168.0.100
step2: tcpdump -i wlan0 host 192.168.0.101
step3: ping 192.168.0.101 

         100-----------------------101
(1)      ICMP REQ------------------>|
(2)       |<-------------------ARP REQ
(3)      ARP RESP------------------>|
(4)       |<-------------------ICMP RESP

CH09 IP选路
-----------------------------------------------------------------------------------------------
.2 IP选路原理：a. 搜匹配的主机地址 b. 搜匹配的网络地址 c.搜默认路由表
.3 路由表的标志：G（GATE）区别间接路由和直接路由 H(HOST)表示是一个完整的主机地址。
.4 （静态）初始化路由表：初始化一个接口是，创建一个直接路由；
   对点对点的的链接和loopback的接口，路由是到达主机；
   对于广播接口来说，路由是到达网络。
.5. (动态) 主机引导后广播或者多播一份路由器请求报文(ICMP)，路由器响应通告报文（ICMP）。

CH10 动态选路协议
-----------------------------------------------------------------------------------------------
.1 动态选路主要用于路由器之间的通信。
.4 RIP: （简化表述）
   a. 启动路由器时，向各个网路接口广播请求发送完成路由
   b. 其他路由器接到请求，发送完整路由表响应
   c. 接受到响应，更新路由表
   d. 定期选路更新，每过30秒，向周边路由器更新本机路由表。

CH11 UDP: 用户数据报协议
-----------------------------------------------------------------------------------------------
.2 UDP首部格式
   TCP和UDP端口相互独立，（但是知名服务通常选择相同的端口号）
   UDP校验和包含UDP数据和UDP首部。
.5 IP分片：如果UDP数据包大于IP层的MTU，则需要分片。UDP首部中有个字段表示“更多的片”。
   可以设置标志位要求强制不分片，此时如大于MTU，会产生ICMP不可达差错。

CH12 广播和多播
-----------------------------------------------------------------------------------------------
.2 受限的广播：255.255.255.255，路由器不转发改广播
   指向网络的广播：netid.255.255.255, netid为网络号
   指向子网的广播
   指向所有子网的广播

CH13 IGMP: Internet组管理协议
-----------------------------------------------------------------------------------------------
.1 IGMP让一个物理网络上的所有系统知道逐级当前所在的多播组。

CH14 DNS: 域名系统
-----------------------------------------------------------------------------------------------
.1 DNS是应用程序的一部分，和内核中的TCP/IP对DNS一无所知。DNS主要使用UDP.
   DNS具有树状的层级结构，由上级机构逐级授权。DNS请求和响应有相同的报文格式。
   DNS服务器一般具有主，备服务器。
   如果一个DNS服务器没有请求的信心，则将请求与其他DNS服务器联系。

CH17 TCP的传输控制协议
-----------------------------------------------------------------------------------------------
.2 报文格式，校验和包括首部和数据。
   标志比特：SYNC, PSH, RST, FIN, ACK, URG.

CH18 TCP的交互数据流
-----------------------------------------------------------------------------------------------
.2 连接的建立，三次握手（sync-syncAck-syncAckAck）
   连接的删除，四次握手（client:fin-finAck, server:fin-finAck)
   TCP全双工，所以删除必须四次握手
.4 MSS, 最大报文段长度=MTU-IP首部-TCP首部，如果MTU=1500，则MSS=1460.
   如果大于MSS，则报文需分段。（如中间路径的MSS过小）
.5 TCP的半关闭，关闭全双工的单向连接
.6 TCP的状态变迁图，TIME_WAIT(2MSL等待，报文最大生存时间)，
    TIME_WAIT为执行主动关闭时候，客户端确保最后ACK发送后丢失，能处理FIN的重传。
.8 LISTEN的进程用来接收请求，ESTABLISHED状态的进程用来交互数据。
   呼入请求队列：已经三次握手完成，还没有被应用程序接收的请求放入改队列。balaballa

CH19 TCP的交互数据流
-----------------------------------------------------------------------------------------------
.1 交互数据流，如telnet，ssh等产生的数据。
.3 经受时延的确认：TCP收到数据后不马上发送ACK，相反，他推迟发送以便将ACK与该方向发送的数据
   一起发送（这种情况叫捎带ACK）。如果在指定时延内无数据发送，则timeout单独发送ACK。
.4 Nagle算法: 一个TCP连接上最多只能有一个未被ACK的小分组，在收到该ACK之前不能发送其他分组，
   并收集这些等待发送的小分组，在ACK收到后将这些小分组一起发送出去。

CH20 TCP的成块数据流
-----------------------------------------------------------------------------------------------
.1 使用TCP滑动窗口协议时，接收方不必确认每一个收到的数据，ACK可以累积
.2 滑动窗口，接受方通过该窗口告知发送方可以发送多少数据给接受方
.5 PUSH标志，发送方通过该标志告知接收方立即将所收到数据交给接受应用进程，不用等待后续数据
.6 慢启动，拥塞窗口，拥塞窗口是发送方的流量控制，滑动窗口是接受方的流量控制

CH21 TCP的超时与重传
-----------------------------------------------------------------------------------------------
.1 对每个TCP连接，TCP同时管理4个不同的定时器：
- 重传定时器；
- 坚持定时器；
- 保活定时器
- 2MSL定时器
.2 重传时间间隔，使用指数退避算法，1.5、3、6、12、24、48....
.3 往返时间(RTT)测量，TCP根据测量的往返时间设置各种超时
.6 拥塞避免算法，慢启动指数增长，拥塞避免线性增长
.7 快速重传和快速恢复，连收3个超重复ACK则不用等超时马上重传，接下来执行拥塞避免。

CH21 TCP的坚持定时器
-----------------------------------------------------------------------------------------------
a. 如果客户端需要发送数据但是服务器段通告滑动窗口大小为0时，需要设置坚持定时器。为什么呢：
因为通告打开滑动窗口的ACK可能意外丢失，导致发送方一直不知道滑动窗口可用，因此设置坚持定时
器周期性的向接收方查询，以便发现窗口是否增大。
b. 定时器周期使用指数退避算法。窗口探寻包含一个字节的数据。

CH22 TCP的保活定时器
-----------------------------------------------------------------------------------------------
a. 保活定时器主要用于服务器端，用来检测客户端是否奔溃。如奔溃，则可以删除链接等。


